<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Matrix Heatmap — Repo Coupling</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>body{margin:0;font-family:Arial,Helvetica,sans-serif}canvas{width:100vw;height:100vh;display:block}#top{position:absolute;left:8px;top:8px;z-index:20;background:#fff;padding:8px;border-radius:6px;box-shadow:0 2px 6px rgba(0,0,0,.12)}</style>
</head>
<body>
  <div id="top" style="position:fixed;left:8px;top:8px;z-index:20;background:#fff;padding:8px;border-radius:6px;box-shadow:0 2px 6px rgba(0,0,0,.12)">
    <a href="viewer_gltf.html">3D Viewer</a> ·
    <a href="force_graph.html">Force Graph</a> ·
    <a href="treemap.html">Treemap</a> ·
    <a href="matrix_heatmap.html"><b>Matrix</b></a>
  </div>
  <canvas id="c"></canvas>
  <script>
    async function load(){
      const meta = await fetch('model_meta.json').then(r=>r.json());
      const nodes = (meta.nodes||[]).map(n=>n.id);
      const index = new Map(nodes.map((id,i)=>[id,i]));
      const N = nodes.length;
      const mat = Array.from({length:N}, ()=>new Uint16Array(N));
      for(const e of (meta.edges||[])){
        const i = index.get(e.from), j = index.get(e.to);
        if(i!=null && j!=null) mat[i][j] = (mat[i][j]||0) + 1;
      }

      const canvas = document.getElementById('c');
      canvas.width = Math.max(600, Math.min(2000, N*16));
      canvas.height = canvas.width;
      const ctx = canvas.getContext('2d');
      const cell = Math.floor(canvas.width / N) || 1;
      // draw cells
      for(let i=0;i<N;i++){
        for(let j=0;j<N;j++){
          const v = mat[i][j];
          const norm = Math.min(1, v/5);
          const r = Math.floor(255*norm), g = 40, b = Math.floor(255*(1-norm));
          ctx.fillStyle = `rgb(${r},${g},${b})`;
          ctx.fillRect(j*cell, i*cell, cell, cell);
        }
      }
      // labels on left
      ctx.fillStyle='black'; ctx.font='12px sans-serif'; ctx.textBaseline='middle';
      for(let i=0;i<N;i++){ ctx.fillText(nodes[i], 4, i*cell + cell/2); }
    }
    load().catch(e=>{ document.body.innerHTML = 'Load failed: '+e; console.error(e); });
  </script>
</body>
</html>
